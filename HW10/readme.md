# Домашнее задание "Хранилище, которое выстояло"

### Цель: погрузиться в работу с большими объёмами данных, опробовать механизмы их загрузки и сравнить производительность разных СУБД;


##### Описание/Пошаговая инструкция выполнения домашнего задания:


Для сравнения с PostgreSQL выбрал ClickHouse, для тестирования загружал данные объемом эквивалентным 10 гигабайтам CSV:

![de3fd4bc3374dd88d9c8b9a7e15c0058.png](./de3fd4bc3374dd88d9c8b9a7e15c0058.png)

![829145e094e741f762a8dcbf31e6ea58.png](./829145e094e741f762a8dcbf31e6ea58.png)

![586f03701577b0ad15df63c227cfb879.png](./586f03701577b0ad15df63c227cfb879.png)

###### Загрузка в ClickHouse (2 минуты)

![6debb234194b5c6b577fc917a031a93e.png](./6debb234194b5c6b577fc917a031a93e.png "6debb234194b5c6b577fc917a031a93e.png")



![7fc2e22fca4c6bf875f61891a147df4b.png](./7fc2e22fca4c6bf875f61891a147df4b.png)


![f2fc0b4706cb95664bc151178624557c.png](./f2fc0b4706cb95664bc151178624557c.png)


Теперь перейдем к PostgreSQL
![352428801333a28e423f23e77085dae4.png](./352428801333a28e423f23e77085dae4.png)

###### Вариант загрузки с COPY (11 минут 15 секунд)

![7300e4d39a0d88e42522ddbb86e3af48.png](./7300e4d39a0d88e42522ddbb86e3af48.png)

###### Вариант загрузки с pg_bulkload (6 минут 51 секунд)
![1c4561dba541dd761231c4ee738b6916.png](./1c4561dba541dd761231c4ee738b6916.png)

Добавил индекс для запроса:

![2d012baba24b2a5d52831f2ab6f73801.png](./2d012baba24b2a5d52831f2ab6f73801.png)

![35a52fcaa272c700ed125a648e528509.png](./35a52fcaa272c700ed125a648e528509.png)


![3105d7a597a9a8485e0d104d5e122b68.png](./3105d7a597a9a8485e0d104d5e122b68.png)


![28ebb00d06f97741f5e6ea46edca4a43.png](./28ebb00d06f97741f5e6ea46edca4a43.png)

![b5ae87f0d6534c3641f7c73cf427326b.png](./b5ae87f0d6534c3641f7c73cf427326b.png)

Как видно из результатов запросов скорость запросов значительно отличается не в пользу PostgreSQL,
ClickHouse намного лучше работает с загрузкой данных в первую очередь за счет остустуствия лога транзакции

Для теста создал материализованную вьюшку в PostgreSQL
![c927c0a3a5ee5a84b48f5d9c7224b99d.png](./c927c0a3a5ee5a84b48f5d9c7224b99d.png)


![9f8470ddc9b722af1ab4decc08200c78.png](./9f8470ddc9b722af1ab4decc08200c78.png)

Даже с учетом материализованной вьюшки число чтений отличается на порядок, ClickHouse очень выигрывает за счет использования колоночного способа хранения данных и сжатия данных

##Вывод: 
очень сильно отличающиеся системы, с разными целями и свойствами. Понравилась простота использования, удобство и продуманность архитектуры ClickHouse, большая скорость OLAP запросов. Всвою очередь на стороне PostgreSQL поддержка транзакций и полная поддержка ACID, большая скорость OLTP и более продвинутый оптимизатор запросов.




