# Домашнее задание "Работа с уровнями изоляции транзакции в PostgreSQL"

### Цель:
- научиться работать с ЯО;\
- научиться управлять уровнем изолции транзации в PostgreSQL;

1. Создать новый проект в Яндекс облако или на любых ВМ, например postgres2024-<yyyymmdd>, где
yyyymmdd год, месяц и день вашего рождения (имя проекта должно быть уникально)
2. Создать инстанс виртуальной машины с дефолтными параметрами - 1-2 ядра, 2-4Гб памяти, любой
линукс (на курсе Ubuntu 100%)

![4b586196a5fac6475a8a93a27d22d5ba.png](./4b586196a5fac6475a8a93a27d22d5ba.png)

4. Добавить свой ssh ключ

![29844fc1609de2ab2c68be84c57876f2.png](./29844fc1609de2ab2c68be84c57876f2.png)

5. Зайти удаленным ssh (первая сессия)

![e2ddcebaed8a86213633c1c9038702d2.png](./e2ddcebaed8a86213633c1c9038702d2.png)

6. Поставить PostgreSQL из пакетов apt install

![d48d9f2c95b2cfca521dfcf0ba6b4b52.png](./d48d9f2c95b2cfca521dfcf0ba6b4b52.png)

7. Зайти вторым ssh (вторая сессия)

![3a1284cf7893188a6f6a5ff0855698a1.png](./3a1284cf7893188a6f6a5ff0855698a1.png)

8. Запустить везде psql из под пользователя postgres
9. Выключить auto commit
10. Сделать в первой сессии новую таблицу и наполнить ее данными

![316059850e036eee716f00867958a0b3.png](./316059850e036eee716f00867958a0b3.png)

11. Посмотреть текущий уровень изоляции: show transaction isolation level
12. Начать новую транзакцию в обоих сессиях с дефолтным (не меняя) уровнем изоляции
13. В первой сессии добавить новую запись

![85145822e167f3f248a3a374365da0c1.png](./85145822e167f3f248a3a374365da0c1.png)

14. Посмотреть таблицу во второй сессии. Видите ли вы новую запись и если да то почему?

![6765f0ef419942bb4afb53f966459745.png](./6765f0ef419942bb4afb53f966459745.png)

**Не видим потому что мы не должны видеть грязные данные из другой транзакции**

15. Завершить первую транзакцию
16. Посмотреть таблицу во второй сессии. Видите ли вы новую запись и если да то почему?
Завершить транзакцию во второй сессии.

![6fb6609fc155c951059c12eb57923632.png](./6fb6609fc155c951059c12eb57923632.png)

**строка видна потому что мы сделали commit в первой сессии**

18. Начать новые транзакции с repeatable read
19. В первой сессии добавить новую запись

![8e58cd9f784f45f6c5b342874cce06e1.png](./8e58cd9f784f45f6c5b342874cce06e1.png)

20. Посмотреть таблицу во второй сессии. Видите ли вы новую запись и если да то почему?

![b3c3c9511f3ae37954368149f6c5eecc.png](./b3c3c9511f3ae37954368149f6c5eecc.png)

**Новую запись не видим потому что Repeatable Read не позволяет грязное чтение**

21. Завершить первую транзакцию
22. Посмотреть таблицу во второй сессии. Видите ли вы новую запись и если да то почему?
Завершить транзакцию во второй сессии.

![e2cf2c72254c454e5754c923e8242a5f.png](./e2cf2c72254c454e5754c923e8242a5f.png)

**Новую запись не видим потому что Repeatable Read защищает от аномалии Non-repeatable Reads**
